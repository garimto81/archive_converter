# PRD-0012: PokerGO Downloader GUI

## 개요

| 항목 | 내용 |
|------|------|
| **제목** | PokerGO Video Downloader GUI |
| **버전** | 1.0.0 |
| **작성일** | 2025-12-15 |
| **상태** | Draft |
| **우선순위** | High |

## 배경

PokerGO에서 제공하는 포커 영상을 다운로드하여 아카이빙하기 위한 GUI 애플리케이션이 필요합니다.
기존 CLI 스크립트를 GUI로 전환하여 사용성을 개선합니다.

### 현재 상황

- 스크래핑된 영상: **206개** (2025-12-12 기준)
- 다운로드 테스트: **성공** (HLS 스트림 via yt-dlp)
- 인증: PokerGO 계정 필요 (.env 파일)

### 다운로드 가능성 검토

| 방식 | 가능 여부 | 비고 |
|------|----------|------|
| yt-dlp + 계정 | O | `--username`, `--password` 옵션 |
| HLS 스트림 직접 | O | JWPlayer m3u8 URL |
| Playwright 쿠키 | O | 브라우저 세션 쿠키 저장 |

## 요구사항

### 기능 요구사항 (FR)

#### FR-1: 영상 목록 조회

```
┌─────────────────────────────────────────────────────────────┐
│  PokerGO Downloader                              [_][□][X]  │
├─────────────────────────────────────────────────────────────┤
│  [Refresh List]  [Settings]                                 │
├─────────────────────────────────────────────────────────────┤
│  Search: [_______________] [Filter: All Shows      v]       │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐  │
│  │ [ ] WSOP 2023 Main Event - Episode 1      │ 1h 30m    │  │
│  │ [ ] WSOP 2023 Main Event - Episode 2      │ 1h 45m    │  │
│  │ [ ] WSOP 2023 Main Event - Final Table    │ 6h 20m    │  │
│  │ [ ] High Stakes Poker - Season 10 Ep 1    │ 45m       │  │
│  │ [ ] Poker After Dark - S13 E01            │ 1h 15m    │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  Selected: 3 videos (9h 35m)        [Download Selected]     │
└─────────────────────────────────────────────────────────────┘
```

- **FR-1.1**: PokerGO API/스크래핑으로 전체 영상 목록 로드
- **FR-1.2**: 영상 정보 표시 (제목, 시간, 썸네일, 쇼명)
- **FR-1.3**: 목록 새로고침 기능

#### FR-2: 검색 및 필터링

- **FR-2.1**: 키워드 검색 (제목, 설명)
- **FR-2.2**: 쇼별 필터 (WSOP, WPT, High Stakes Poker 등)
- **FR-2.3**: 연도별 필터 (2018, 2019, ..., 2025)
- **FR-2.4**: 다운로드 상태별 필터 (전체, 미완료, 완료)

```
Filter Options:
┌─────────────────────────┐
│ Show:                   │
│ [x] WSOP                │
│ [x] WPT                 │
│ [ ] High Stakes Poker   │
│ [ ] Poker After Dark    │
│ [ ] Hustler Casino Live │
│ [ ] Super High Roller   │
├─────────────────────────┤
│ Year:                   │
│ [2018-2025 Slider]      │
├─────────────────────────┤
│ Status:                 │
│ ( ) All                 │
│ (x) Not Downloaded      │
│ ( ) Downloaded          │
└─────────────────────────┘
```

#### FR-3: 다운로드 항목 선정

- **FR-3.1**: 체크박스로 개별 선택
- **FR-3.2**: 전체 선택 / 해제
- **FR-3.3**: 필터 결과 전체 선택
- **FR-3.4**: 선택 항목 요약 표시 (개수, 예상 용량)

#### FR-4: 다운로드 실행 및 모니터링

```
┌─────────────────────────────────────────────────────────────┐
│  Download Progress                                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Overall: [###########################-----------] 65%      │
│           3 / 5 videos completed                            │
│                                                             │
│  Current: WSOP 2023 ME - Episode 3                          │
│           [##################--------------------] 45%      │
│           1.2 GB / 2.7 GB | 12.5 MB/s | ETA: 2m 30s         │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Log:                                                       │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ [15:30:45] Started: WSOP 2023 ME - Episode 1          │  │
│  │ [15:32:10] Completed: Episode 1 (1.3 GB)              │  │
│  │ [15:32:11] Started: WSOP 2023 ME - Episode 2          │  │
│  │ [15:34:05] Completed: Episode 2 (1.4 GB)              │  │
│  │ [15:34:06] Started: WSOP 2023 ME - Episode 3          │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  [Pause]  [Cancel]                              [Close]     │
└─────────────────────────────────────────────────────────────┘
```

- **FR-4.1**: 전체 진행률 표시
- **FR-4.2**: 현재 다운로드 진행률 (%, 용량, 속도, ETA)
- **FR-4.3**: 다운로드 로그
- **FR-4.4**: 일시정지 / 재개 기능
- **FR-4.5**: 취소 기능
- **FR-4.6**: 다운로드 완료 알림

#### FR-5: 설정

- **FR-5.1**: PokerGO 계정 설정 (ID/Password)
- **FR-5.2**: 다운로드 경로 설정
- **FR-5.3**: 동시 다운로드 수 설정 (1-3)
- **FR-5.4**: 비디오 품질 선택 (Best, 1080p, 720p)

### 비기능 요구사항 (NFR)

| ID | 요구사항 | 기준 |
|----|---------|------|
| NFR-1 | 응답성 | UI 반응 < 100ms |
| NFR-2 | 안정성 | 다운로드 실패 시 자동 재시도 (3회) |
| NFR-3 | 저장 | 다운로드 상태 영구 저장 (SQLite) |
| NFR-4 | 크로스플랫폼 | Windows 우선 (추후 Mac/Linux) |

## 기술 스택

| 구성요소 | 기술 | 이유 |
|---------|------|------|
| **GUI Framework** | PyQt6 / PySide6 | 네이티브 룩앤필, 풍부한 위젯 |
| **다운로드** | yt-dlp | HLS 스트림 지원, 안정적 |
| **스크래핑** | Playwright | 동적 페이지 처리, 인증 |
| **데이터베이스** | SQLite | 로컬 저장, 설정 없음 |
| **스레딩** | QThread | UI 블로킹 방지 |

### 대안 검토

| 옵션 | 장점 | 단점 | 결정 |
|------|------|------|------|
| PyQt6 | 성숙, 문서화 | 라이선스 (GPL) | **선택** |
| Tkinter | 내장, 가벼움 | UI 제한 | - |
| CustomTkinter | 모던 UI | 기능 제한 | - |
| Electron | 웹 기술 | 무거움, 리소스 | - |

## 아키텍처

```
┌──────────────────────────────────────────────────────────────┐
│                        GUI Layer (PyQt6)                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │MainWindow│  │VideoList │  │DownloadQ │  │ Settings │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────┴────────────────────────────────────┐
│                      Service Layer                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │PokerGoService│  │DownloadService│  │ConfigService │        │
│  └──────────────┘  └──────────────┘  └──────────────┘        │
└─────────────────────────┬────────────────────────────────────┘
                          │
┌─────────────────────────┴────────────────────────────────────┐
│                      Core Layer                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │   Scraper    │  │   YtDlp      │  │   Database   │        │
│  │ (Playwright) │  │  Wrapper     │  │  (SQLite)    │        │
│  └──────────────┘  └──────────────┘  └──────────────┘        │
└──────────────────────────────────────────────────────────────┘
```

## 데이터 모델

```python
# SQLite 스키마

class Video:
    id: str                 # 고유 ID (URL 기반)
    title: str              # 제목
    show: str               # 쇼명 (WSOP, WPT, etc.)
    season: str | None      # 시즌
    episode: str | None     # 에피소드
    year: int | None        # 연도
    duration: int           # 길이 (초)
    thumbnail_url: str      # 썸네일 URL
    video_url: str          # 비디오 페이지 URL
    hls_url: str | None     # HLS 스트림 URL
    status: str             # pending, downloading, completed, failed
    file_path: str | None   # 다운로드된 파일 경로
    file_size: int | None   # 파일 크기 (bytes)
    created_at: datetime
    updated_at: datetime

class DownloadQueue:
    id: int
    video_id: str
    priority: int
    status: str             # queued, downloading, paused, completed, failed
    progress: float         # 0.0 - 100.0
    speed: float            # bytes/s
    eta: int                # 남은 시간 (초)
    error_message: str | None
    retry_count: int
    created_at: datetime
    started_at: datetime | None
    completed_at: datetime | None

class Config:
    key: str
    value: str
```

## 파일 구조

```
Archive_Converter/
├── pokergo_downloader/           # GUI 애플리케이션
│   ├── __init__.py
│   ├── main.py                   # 진입점
│   ├── app.py                    # QApplication
│   │
│   ├── ui/                       # UI 컴포넌트
│   │   ├── __init__.py
│   │   ├── main_window.py        # 메인 윈도우
│   │   ├── video_list.py         # 비디오 목록 위젯
│   │   ├── download_panel.py     # 다운로드 패널
│   │   ├── settings_dialog.py    # 설정 다이얼로그
│   │   └── filter_panel.py       # 필터 패널
│   │
│   ├── services/                 # 비즈니스 로직
│   │   ├── __init__.py
│   │   ├── pokergo_service.py    # PokerGO API/스크래핑
│   │   ├── download_service.py   # 다운로드 관리
│   │   └── config_service.py     # 설정 관리
│   │
│   ├── core/                     # 핵심 기능
│   │   ├── __init__.py
│   │   ├── scraper.py            # Playwright 스크래퍼
│   │   ├── downloader.py         # yt-dlp 래퍼
│   │   └── database.py           # SQLite 관리
│   │
│   ├── models/                   # 데이터 모델
│   │   ├── __init__.py
│   │   ├── video.py
│   │   └── download.py
│   │
│   └── resources/                # 리소스
│       ├── icons/
│       └── styles/
│
├── data/
│   └── pokergo/
│       ├── pokergo.db            # SQLite 데이터베이스
│       ├── downloads/            # 다운로드 폴더
│       └── cache/                # 썸네일 캐시
│
└── requirements-gui.txt          # GUI 의존성
```

## 구현 계획

### Phase 1: 기본 구조 (MVP)

| 작업 | 설명 | 예상 |
|------|------|------|
| 1.1 | PyQt6 프로젝트 설정 | - |
| 1.2 | 메인 윈도우 레이아웃 | - |
| 1.3 | SQLite 데이터베이스 설정 | - |
| 1.4 | 비디오 목록 위젯 | - |
| 1.5 | 기존 스크래핑 데이터 임포트 | - |

### Phase 2: 검색 및 필터

| 작업 | 설명 | 예상 |
|------|------|------|
| 2.1 | 검색 입력 필드 | - |
| 2.2 | 쇼별 필터 | - |
| 2.3 | 연도별 필터 | - |
| 2.4 | 상태별 필터 | - |

### Phase 3: 다운로드 기능

| 작업 | 설명 | 예상 |
|------|------|------|
| 3.1 | 다운로드 큐 관리 | - |
| 3.2 | yt-dlp 통합 | - |
| 3.3 | 진행률 표시 | - |
| 3.4 | 일시정지/재개/취소 | - |

### Phase 4: 설정 및 마무리

| 작업 | 설명 | 예상 |
|------|------|------|
| 4.1 | 설정 다이얼로그 | - |
| 4.2 | 계정 관리 | - |
| 4.3 | 에러 처리 | - |
| 4.4 | 테스트 및 버그 수정 | - |

## UI 목업

### 메인 화면

```
┌─────────────────────────────────────────────────────────────────┐
│  PokerGO Downloader v1.0                           [_] [□] [X]  │
├─────────────────────────────────────────────────────────────────┤
│  [🔄 Refresh]  [⚙ Settings]                        📊 206 videos │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │  🔍 Search: [________________________]  [Filter ▼]          │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │  [☑] Select All                                             │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │  [☑] [🎬] WSOP 2023 Main Event - Episode 1                  │ │
│ │       WSOP | 2023 | 1h 30m | ⬇️ Downloaded                   │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │  [☑] [🎬] WSOP 2023 Main Event - Episode 2                  │ │
│ │       WSOP | 2023 | 1h 45m | ⏳ Pending                      │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │  [☐] [🎬] High Stakes Poker - Season 10 Ep 1                │ │
│ │       HSP | 2023 | 45m | ⏳ Pending                          │ │
│ └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  Selected: 2 videos | Est. Size: ~3.2 GB                        │
│                                          [📥 Download Selected] │
└─────────────────────────────────────────────────────────────────┘
```

### 다운로드 진행 화면

```
┌─────────────────────────────────────────────────────────────────┐
│  Download Progress                                   [_] [□] [X] │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📊 Overall Progress                                             │
│  [████████████████████░░░░░░░░░░░░░░░░░░░░] 45%                 │
│  2 / 5 videos completed | 3.2 GB / 7.1 GB                       │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📥 Current Download                                             │
│  WSOP 2023 Main Event - Episode 3                               │
│  [████████████████░░░░░░░░░░░░░░░░░░░░░░░░] 40%                 │
│  512 MB / 1.28 GB | 15.2 MB/s | ETA: 0:52                       │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│  📋 Queue                                                        │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │ ✅ Episode 1                          1.30 GB   Completed │  │
│  │ ✅ Episode 2                          1.45 GB   Completed │  │
│  │ 🔄 Episode 3                          512 MB    40%       │  │
│  │ ⏳ Episode 4                          -         Queued    │  │
│  │ ⏳ Episode 5                          -         Queued    │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│  [⏸ Pause]  [⏹ Cancel All]                          [✖ Close]  │
└─────────────────────────────────────────────────────────────────┘
```

## 위험 요소

| 위험 | 영향 | 완화 방안 |
|------|------|----------|
| PokerGO 사이트 구조 변경 | 스크래핑 실패 | 다중 셀렉터, 폴백 로직 |
| HLS URL 만료 | 다운로드 실패 | 다운로드 직전 URL 갱신 |
| 계정 차단 | 서비스 불가 | 요청 속도 제한, 재시도 간격 |
| 대용량 다운로드 | 디스크 부족 | 용량 확인, 경고 표시 |

## 성공 지표

| 지표 | 목표 |
|------|------|
| 전체 영상 조회 | 200+ 영상 목록 표시 |
| 검색 정확도 | 키워드 일치 100% |
| 다운로드 성공률 | 95% 이상 |
| UI 응답성 | 100ms 이내 |

## 참고 자료

- 기존 스크래퍼: `scripts/pokergo_full_scraper.py`
- 기존 다운로드 테스트: `scripts/pokergo_download_test.py`
- 스크래핑 데이터: `data/pokergo/pokergo_merged_*.json`
- PyQt6 문서: https://www.riverbankcomputing.com/static/Docs/PyQt6/

## 승인

| 역할 | 이름 | 날짜 |
|------|------|------|
| 작성자 | Claude | 2025-12-15 |
| 검토자 | - | - |
| 승인자 | - | - |
